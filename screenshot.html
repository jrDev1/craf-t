<html>

<script>
// References to all the element we will need.,
var image = document.querySelector('#snap'),
    //start_camera = document.querySelector('#start-camera'),
    controls = document.querySelector('.controls'),
    take_photo_btn = document.querySelector('#take-photo'),
    delete_photo_btn = document.querySelector('#delete-photo'),
    download_photo_btn = document.querySelector('#download-photo');
    //error_message = document.querySelector('#error-message');

take_photo_btn.addEventListener("click", function(e){

    e.preventDefault();
    var video = document.querySelector('video')
    var snap = takeSnapshot(video);

    // Show image. 
    image.setAttribute('src', snap);
    image.classList.add("visible");

    // Enable delete and save buttons
    delete_photo_btn.classList.remove("disabled");
    download_photo_btn.classList.remove("disabled");

    // Set the href attribute of the download button to the snap url.
    download_photo_btn.href = snap;

    // Pause video playback of stream.
    //video.pause();

});


delete_photo_btn.addEventListener("click", function(e){

    e.preventDefault();

    // Hide image.
    image.setAttribute('src', "");
    image.classList.remove("visible");

    // Disable delete and save buttons
    delete_photo_btn.classList.add("disabled");
    download_photo_btn.classList.add("disabled");

    // Resume playback of stream.
    //video.play();

});

    function takeSnapshot(video){
    // Here we're using a trick that involves a hidden canvas element.  

    var hidden_canvas = document.querySelector('canvas'),
        context = hidden_canvas.getContext('2d');

    var width = video.videoWidth,
        height = video.videoHeight;

    if (width && height) {

        // Setup a canvas with the same dimensions as the video.
        hidden_canvas.width = width;
        hidden_canvas.height = height;

        // Make a copy of the current frame in the video on the canvas.
        context.drawImage(video, 0, 0, width, height);

        // Turn the canvas image into a dataURL that can be used as a src for our photo.
        return hidden_canvas.toDataURL('image/png');
    }
}
</script>
<body>
  <a-scene embedded arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;" antialias="true">
      <canvas></canvas>
      <a-assets>
        <a-asset-item id="gltf1" src="model_captain/scene.gltf"></a-asset-item>
        <a-asset-item id="gltf2" src="model_stormtrooper/scene.gltf"></a-asset-item>
      </a-assets>
      <a-marker type="pattern" url="https://raw.githubusercontent.com/Esmolan/Esmolan.github.io/master/juguetron-marker.patt" size="1">
			<a-gltf-model src="#gltf1" 
				position="0 2.5 -1"
				rotation="0 0 0"
				scale="0.05 0.05 0.05"
				animation-mixer="loop:repeat">
			</a-gltf-model>	
      </a-marker>
      <a-marker preset="hiro">
 			<a-gltf-model src="#gltf2" 
				position="0 0 0"
				rotation="0 0 0"
				scale="1 1 1"
				animation-mixer="loop:repeat">
			</a-gltf-model>	
	  </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
  <div class="container">
	  <div class="app">
	    <a href="#" id="start-camera" class="visible">Touch here to start the app.</a>
	    <img id="snap">
	    <p id="error-message"></p>
	    <a href="#" id="delete-photo" title="Delete Photo" class="disabled"><i class="material-icons">delete</i></a>
	    <a href="#" id="take-photo" title="Take Photo"><i class="material-icons">camera_alt</i></a>
	    <a href="#" id="download-photo" download="selfie.png" title="Save Photo" class="disabled"><i class="material-icons">file_download</i></a>   
	  </div>
  </div>
  
 </html>
